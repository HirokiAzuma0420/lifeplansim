# 基本設計書 - ライフプランシミュレーター

## 1. 概要
本ドキュメントは、要件定義書で定められたライフプランシミュレーターを実現するための、基本的なシステム設計について記述する。

## 2. システム構成図

```
+-----------------+      HTTPS      +--------------------------+
|   Webブラウザ   | <-------------> |      Vercel Hosting      |
| (React / Vite)  |   (REST API)    |                          |
+-----------------+                 | +----------------------+ |
                                    | |  Frontend (Static)   | |
                                    | +----------------------+ |
                                    |                          |
                                    | +----------------------+ |
                                    | |  Backend (Serverless)| |
                                    | |  (e.g., /api/simulate)| |
                                    | +----------------------+ |
                                    +--------------------------+
```

## 3. アーキテクチャ
- **フロントエンド**:
    - Viteでビルドされた静的なReactアプリケーション。
    - ユーザーからの入力値の管理、状態管理、APIへのリクエスト、結果の描画を担当する。
    - ライブラリ: React, TypeScript, Chart.js (グラフ描画), Zustand/Redux Toolkit (状態管理)
- **バックエンド**:
    - Vercelのサーバーレス関数 (Node.js/TypeScript) として実装。
    - 複雑なシミュレーション計算ロジックを担当する。
    - フロントエンドからシミュレーションに必要なパラメータをJSON形式で受け取り、計算結果をJSON形式で返す。

## 4. 画面構成
1.  **トップページ (`/`)**: アプリケーションの紹介、シミュレーション開始への導線。
2.  **入力フォームページ (`/form`)**:
    - ユーザーの情報を入力するためのマルチステップフォーム。
    - 各ステップはアコーディオンやタブでセクション分けされる（個人、収入、支出、資産など）。
    - 入力値はリアルタイムで検証される。
3.  **結果表示ページ (`/result`)**:
    - APIから受け取ったシミュレーション結果を可視化する。
    - 複数のチャートコンポーネントとサマリーコンポーネントで構成される。

## 5. APIエンドポイント設計

### `POST /api/simulate`
- **説明**: ライフプランシミュレーションを実行する。
- **リクエストボディ**: ユーザーがフォームで入力した全てのパラメータを含むJSONオブジェクト。
  ```json
  {
    "personal": { "age": 30, ... },
    "income": { "currentAnnualIncomeJPY": 5000000, ... },
    "expenses": { ... },
    "assets": { ... },
    // ... 他の入力項目
  }
  ```
- **レスポンスボディ**: シミュレーション結果の年次データ、サマリー、偏差値などを含むJSONオブジェクト。
  ```json
  {
    "annualData": [ { "year": 1, "age": 31, "totalAssets": 6000000, ... }, ... ],
    "summary": { "finalAssets": 80000000, "rank": "A", ... },
    "deviation": { "income": 55, "assets": 60 }
  }
  ```

## 6. データ構造（主要な型定義）
- フロントエンドとバックエンドで共通の型定義ファイル (`src/types/simulation.ts` など) を使用し、データの一貫性を保つ。
- ユーザー入力 (`SimulationInput`), シミュレーション結果 (`SimulationResult`) などの主要な型を定義する。
