# ResultPage.tsxにおけるシミュレーション結果の可視化

このドキュメントは、`ResultPage.tsx`がシミュレーション結果（`yearlyData`）をどのように受け取り、各ダッシュボードコンポーネントを通じて可視化しているかを解説します。

## 1. データの前処理 (`buildDashboardDataset`)

`ResultPage.tsx` は、まず `src/utils/dashboard-helper.ts` の `buildDashboardDataset` 関数を使い、APIから受け取った `yearlyData` を各コンポーネントが利用しやすい形式のデータセットに変換します。

- **入力**: `yearlyData` (年ごとのシミュレーション結果の配列)
- **出力**: 
    - `enrichedData`: 年ごとの `現金`, `NISA`, `iDeCo`, `課税口座`, `総資産`, `投資元本` などを日本語キーで格納した配列。
    - `pieData`: シミュレーション**最終年**の資産構成データ（`現金`, `NISA`, `iDeCo`, `課税口座`）。
    - `latestYear`, `firstYear`: シミュレーションの最終年と初年度の生データ。

## 2. 表示コンポーネント詳細

以下は、`ResultPage.tsx` で使用される各可視化コンポーネントの詳細です。

### `TotalAssetChart.tsx`

- **目的**: シミュレーション期間を通した総資産の推移を、資産の内訳と共に積み上げ面グラフで表示します。
- **使用データ**: `enrichedData`
- **可視化方法**:
    - **グラフ種類**: 積み上げ面グラフ (AreaChart)
    - **X軸**: 年 (`year`)
    - **Y軸**: 資産額 (円)
    - **データ系列**: `現金`, `NISA`, `iDeCo`, `課税口座` をそれぞれ異なる色で積み上げて表示します。
    - **その他**:
        - 退職年齢 (`retireAge`) の年に赤い基準線が引かれます。
        - 最終資産額に基づいて決定された**資産ランク**（S, A, Bなど）が、イラストと共にグラフ上部に表示されます。

### `AssetPieChart.tsx`

- **目的**: シミュレーション**最終年**における資産構成の割合を円グラフで表示します。
- **使用データ**: `pieData`
- **可視化方法**:
    - **グラフ種類**: 円グラフ (PieChart)
    - **内容**: `現金`, `NISA`, `iDeCo`, `課税口座` のうち、残高が0より大きい資産が、総資産に占める割合に応じてセクターの大きさで表現されます。
    - **ラベル**: 各セクターに資産名と構成比率（%）が表示されます。

### `InvestmentPrincipalChart.tsx`

- **目的**: 投資資産（NISA, iDeCo, 課税口座）の**時価評価額**と、投資元本の合計額の推移を時系列で表示します。
- **使用データ**: `enrichedData`
- **可視化方法**:
    - **グラフ種類**: 折れ線グラフ (LineChart)
    - **X軸**: 年 (`year`)
    - **Y軸**: 資産額 (円)
    - **データ系列**:
        - `NISA`, `iDeCo`, `課税口座` の各時価評価額が、それぞれ別の色の線で描画されます。
        - `投資元本` の合計額が、別の線で描画されます。

### `AssetTable.tsx`

- **目的**: シミュレーション期間中の各年の資産詳細（**時価評価額**）をテーブル形式で一覧表示します。
- **使用データ**: `enrichedData`
- **可視化方法**:
    - **テーブル形式**:
        - **行**: シミュレーションの各年
        - **列**: `年`, `現金`, `NISA`, `iDeCo`, `課税口座`, `総資産`

### `IncomePositionChart.tsx`

- **目的**: シミュレーション開始時のユーザーの年収が、同年代の収入分布の中でどの位置にあるかを相対的に示します。
- **使用データ**:
    - シミュレーション初年度の `age` と `income`。
    - 静的データファイル `net_income_brackets.json` （年齢階級別の収入分布データ）。
- **可視化方法**:
    - **棒グラフ**: 年齢階級ごとの収入分布をパーセンテージで表示します。
    - **偏差値表示**: ユーザーの収入が分布の中でどの偏差値に位置するかを計算し、グラフ上に吹き出しで表示します。
    - **順位表示**: 「上位〇%」という形で、同年代内での相対的な順位をテキストで表示します。

### `SavingsPositionChart.tsx`

- **目的**: シミュレーション開始時のユーザーの金融資産額が、同年代・同収入層の中でどの位置にあるかを相対的に示します。
- **使用データ**:
    - シミュレーション初年度の `age`, `income`, `totalAssets` (総資産)。
    - 静的データファイル `saving.json` （年齢・年収階級別の金融資産分布データ）。
- **可視化方法**:
    - **棒グラフ**: 年齢・年収階級ごとの金融資産の分布をパーセンテージで表示します。
    - **偏差値表示**: ユーザーの資産額の偏差値を計算し、グラフ上に吹き出しで表示します。
    - **順位表示**: 「上位〇%」という形で、同階級内での相対的な順位をテキストで表示します。
