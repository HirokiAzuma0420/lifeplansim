# ResultPage.tsxにおけるシミュレーション結果の可視化

このドキュメントは、`ResultPage.tsx`がシミュレーション結果（`yearlyData`）をどのように受け取り、各ダッシュボードコンポーネントを通じて可視化しているかを解説します。

## 1. データの前処理

`ResultPage.tsx` は、まず `src/utils/simulation.ts` の `buildDashboardDataset` 関数を使い、APIから受け取った `yearlyData` を各コンポーネントが利用しやすい形式のデータセットに変換します。

- **入力**: `yearlyData` (年ごとのシミュレーション結果の配列)
- **出力**: 
    - `enrichedData`: 年ごとの `現金 (savings)`, `NISA (nisa)`, `iDeCo (ideco)`, `総資産 (totalAssets)`, `投資元本 (investedPrincipal)` を日本語キーに変換した配列。(*修正ポイント* 投資商品についてはProducts配列に格納された要素別にしてほしい）
    - `pieData`: シミュレーション**最終年**の `現金`, `NISA`, `iDeCo` の資産構成データ。 (*修正ポイント* Products配列に入った要素別のpieデータにしてほしい）
    - `latestYear`, `firstYear`: シミュレーションの最終年と初年度の生データ。

## 2. 表示コンポーネント詳細

以下は、`ResultPage.tsx` で使用される各可視化コンポーネントの詳細です。

### `TotalAssetChart.tsx`

- **目的**: シミュレーション期間を通した総資産の推移を、資産の内訳（現金, NISA, iDeCo）と共に表示します。(*修正ポイント* 資産の内訳は現金、Products配列の各要素にしてほしい)
- **使用データ**: `enrichedData`
- **可視化方法**:
    - **グラフ種類**: 積み上げ面グラフ (AreaChart)
    - **X軸**: 年 (`year`)
    - **Y軸**: 資産額 (円)
    - **データ系列**: `現金`, `NISA`, `iDeCo` をそれぞれ異なる色で積み上げて表示します。(*修正ポイント* 現金、各投資商品(Products)別の表示にしてほしい)
    - **その他**:
        - 退職年齢 (`retireAge`) の年に赤い基準線が引かれます。
        - 10年ごとに総資産額のラベルがグラフ上に表示されます。
        - 最終資産額に基づいて決定された**資産ランク**（S, A, Bなど）が、イラストと共にグラフ上部に表示されます。

### `AssetPieChart.tsx`

- **目的**: シミュレーション**最終年**における資産構成の割合を円グラフで表示します。
- **使用データ**: `pieData`
- **可視化方法**:
    - **グラフ種類**: 円グラフ (PieChart)
    - **内容**: `現金`, `NISA`, `iDeCo` の3つの資産が、総資産に占める割合に応じてセクターの大きさで表現されます。
    - **ラベル**: 各セクターに資産名と構成比率（%）が表示されます。

### `InvestmentPrincipalChart.tsx`

- **目的**: NISAとiDeCoの資産額の推移を時系列で表示します。
- **使用データ**: `enrichedData` から `NISA` と `iDeCo` の時系列データを抽出。
- **可視化方法**:
    - **グラフ種類**: 折れ線グラフ (LineChart)
    - **X軸**: 年 (`year`) ※2050年までのデータに限定
    - **Y軸**: 資産額 (円)
    - **データ系列**: `NISA` と `iDeCo` の資産額推移が、それぞれ別の色の線で描画されます。
    - **<span style="color:red;">※注</span>**: コンポーネント名は「積立元本推移」ですが、実際に表示されているのは `investedPrincipal` (元本) ではなく、各資産の**時価評価額**です。

### `AssetTable.tsx`

- **目的**: シミュレーション期間中の各年の資産詳細をテーブル形式で一覧表示します。
- **使用データ**: `enrichedData`
- **可視化方法**:
    - **テーブル形式**:
        - **行**: シミュレーションの各年
        - **列**: `年`, `現金`, `NISA`, `iDeCo`, `総資産`
    - **<span style="color:red;">※注</span>**: テーブルのヘッダーには「NISA積立」「iDeCo積立」という列が存在しますが、表示されているデータは各資産の**時価評価額**であり、その年の積立額ではありません。

### `IncomePositionChart.tsx`

- **目的**: シミュレーション開始時のユーザーの年収が、同年代の収入分布の中でどの位置にあるかを相対的に示します。
- **使用データ**:
    - シミュレーション初年度の `age` と `income`。
    - 静的データファイル `tingin.json` （年齢階級別の収入分布データ）。
- **可視化方法**:
    - **棒グラフ**: 年齢階級ごとの収入分布をパーセンテージで表示します。
    - **偏差値表示**: ユーザーの収入が分布の中でどの偏差値に位置するかを計算し、グラフ上に吹き出しで表示します。
    - **順位表示**: 「上位〇%」という形で、同年代内での相対的な順位をテキストで表示します。

### `SavingsPositionChart.tsx`

- **目的**: シミュレーション開始時のユーザーの金融資産額が、同年代・同収入層の中でどの位置にあるかを相対的に示します。
- **使用データ**:
    - シミュレーション初年度の `age`, `income`, `savings` (総資産)。
    - 静的データファイル `saving.json` （年齢・年収階級別の金融資産分布データ）。
- **可視化方法**:
    - **棒グラフ**: 年齢・年収階級ごとの金融資産の分布をパーセンテージで表示します。
    - **偏差値表示**: ユーザーの資産額の偏差値を計算し、グラフ上に吹き出しで表示します。
    - **順位表示**: 「上位〇%」という形で、同階級内での相対的な順位をテキストで表示します。
