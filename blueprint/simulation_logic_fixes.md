# シミュレーションロジックの修正案

## 1. 投資リターン（ストレステスト）の計算ロジック修正

### 問題点

ストレステスト選択時、各投資商品の年間リターンを乱数で生成していますが、シミュレーション期間全体で見たときに、ユーザーが設定した「平均想定リターン」に収束することが保証されていません。
現在のロジックでは、各年のリターンが独立した乱数で決まるため、結果的に平均リターンが想定よりも大幅に高くなったり低くなったりする可能性があります。

### 修正方針

ユーザーが設定した「平均想定リターン」を尊重しつつ、リスク（ボラティリティ）を反映したシミュレーションを実現するため、以下のロジックを導入します。

1.  **中心傾向の維持:** 各金融商品について、シミュレーション期間全体の幾何平均リターンが、ユーザー設定の「平均想定リターン」と一致するように、各年のリターンを生成します。
2.  **リスクの反映:** 正規分布に従う乱数を生成し、リターンにばらつきを持たせます。この際の標準偏差（ボラティリティ）は、金融商品の種類に応じて内部的に固定値を設定します（例：株式は15-20%、債券は5-7%など）。ユーザーがボラティリティを直接入力する必要はありません。
3.  **具体的な実装案:**
    *   まず、目標とする幾何平均リターン `R_g` とボラティリティ `σ` を設定します。
    *   算術平均 `R_a` を `R_a ≈ R_g + σ^2 / 2` の関係式から求めます。
    *   各年のリターン `r_t` を、平均 `R_a`、標準偏差 `σ` の正規分布に従う乱数として生成します。
    *   `r_t = N(R_a, σ^2)`
    *   この方法により、期間全体で見ればリターンが中心（目標リターン）に収束しやすくなり、かつ年ごとのリスクも表現できます。
